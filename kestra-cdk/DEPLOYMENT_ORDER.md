#!/bin/bash
# Deployment order for Kestra CDK stacks

echo "üìã Kestra CDK Stack Deployment Order"
echo "======================================"
echo ""
echo "Based on dependencies, deploy in this order:"
echo ""
echo "1Ô∏è‚É£  KestraVpcStack"
echo "    ‚îî‚îÄ Base network infrastructure"
echo ""
echo "2Ô∏è‚É£  KestraEcsClusterStack"
echo "    ‚îî‚îÄ Depends on: VPC"
echo ""
echo "3Ô∏è‚É£  KestraEfsStack"
echo "    ‚îî‚îÄ Depends on: Cluster"
echo ""
echo "4Ô∏è‚É£  KestraS3Stack"
echo "    ‚îî‚îÄ Depends on: EFS"
echo ""
echo "5Ô∏è‚É£  KestraEcsTaskStack ‚ö†Ô∏è IMPORTANT"
echo "    ‚îî‚îÄ Depends on: EFS, Cluster"
echo "    ‚îî‚îÄ Creates task definition (must be active before service)"
echo ""
echo "6Ô∏è‚É£  KestraAlbStack"
echo "    ‚îî‚îÄ Depends on: Task, Cluster, VPC"
echo ""
echo "7Ô∏è‚É£  KestraEcsServiceStack ‚ö†Ô∏è IMPORTANT"
echo "    ‚îî‚îÄ Depends on: Task, ALB"
echo "    ‚îî‚îÄ Must deploy AFTER task stack to get active task definition"
echo ""
echo "8Ô∏è‚É£  KestraWafStack (optional)"
echo "    ‚îî‚îÄ Depends on: ALB"
echo "    ‚îî‚îÄ Can deploy anytime AFTER ALB stack"
echo ""
echo "9Ô∏è‚É£  KestraBackupStack (optional)"
echo "    ‚îî‚îÄ Depends on: EFS"
echo "    ‚îî‚îÄ Can deploy anytime AFTER EFS stack"
echo ""
echo "üîü KestraCdkStack (independent, can deploy anytime)"
echo ""
echo "======================================"
echo ""
echo "Quick Deploy Commands:"
echo ""
echo "# Full deployment (core stacks):"
echo "npx cdk deploy KestraVpcStack \\"
echo "  && npx cdk deploy KestraEcsClusterStack \\"
echo "  && npx cdk deploy KestraEfsStack \\"
echo "  && npx cdk deploy KestraS3Stack \\"
echo "  && npx cdk deploy KestraEcsTaskStack \\"
echo "  && npx cdk deploy KestraAlbStack \\"
echo "  && npx cdk deploy KestraEcsServiceStack"
echo ""
echo "# Optional stacks (can deploy anytime after dependencies):"
echo "npx cdk deploy KestraWafStack      # After ALB"
echo "npx cdk deploy KestraBackupStack  # After EFS"
echo ""
echo "# Or use the deploy script:"
echo "./scripts/deploy-kestra-stacks.sh"
echo ""
echo "======================================"
echo ""
echo "‚ö†Ô∏è  CRITICAL ORDER:"
echo "   Task Stack ‚Üí ALB Stack ‚Üí Service Stack"
echo ""
echo "   This ensures:"
echo "   - Task definition is active before service uses it"
echo "   - ALB is ready before service attaches to it"

